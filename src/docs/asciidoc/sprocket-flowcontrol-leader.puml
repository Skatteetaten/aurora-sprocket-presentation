@startuml
scale 600 height
!include skatt.iuml
skinparam  BackgroundColor white






database KubernetesP<<kubernetes>> [
prod
]

database KubernetesU<<kubernetes>> [
utv
]

database KubernetesT<<kubernetes>> [
test
]

rectangle BuildPartition<<leader>>
rectangle DeployProdPartition<<leader>>
rectangle DeployTestPartition<<leader>>
rectangle DeployUtvPartition<<leader>>

database ResourceQueue<<sprocket>>

interface ExternalService

BuildPartition --> ResourceQueue : 1.fetch affected builds
BuildPartition --> KubernetesU : 2. start builds

DeployProdPartition --> ResourceQueue : 1. fetch deploys for prod
DeployProdPartition -right-> ExternalService: 2. onUpdateHook
DeployProdPartition -down-> KubernetesP : 3. deploy

DeployTestPartition -up-> ResourceQueue : 1. fetch deploys for test
DeployTestPartition --> KubernetesT : 2. deploy

DeployUtvPartition -up-> ResourceQueue : 1. fetch deploys for utv
DeployUtvPartition --> KubernetesU : 2. deploy

@enduml